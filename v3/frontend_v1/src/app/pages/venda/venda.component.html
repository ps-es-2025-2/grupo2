<div class="page-container">
  <header class="top-header">
    <div class="header-brand">
      <h1>Caneco Cheio</h1>
    </div>
    <nav class="top-nav">
      <a routerLink="/produtos">Gerenciar Produtos</a>
      <a routerLink="/eventos">Gerenciar Eventos</a>
      <a routerLink="/estoque">Estoque</a>
      <a routerLink="/venda" routerLinkActive="active">Nova Venda (PDV)</a>
      <a routerLink="/caixa">Controle de Caixa</a>
      <a routerLink="/fichas">Fichas</a>
    </nav>
    <button class="logout-btn" routerLink="/dashboard">Voltar</button>
  </header>

  <div class="main-content">
    <div class="page-header">
      <h2>PDV - Nova Venda</h2>
    </div>

    <div *ngIf="!vendaConcluida" class="pdv-container">
      <div class="product-selection">
        <h3>Selecionar Produtos</h3>
        
        <!-- FormulÃ¡rio do Cliente -->
        <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
          <h4>Dados do Cliente</h4>
          <div style="display: grid; gap: 10px;">
            <input type="text" [(ngModel)]="clienteNovo.nome" placeholder="Nome do cliente *" required 
                   style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;" />
            <input type="tel" [(ngModel)]="clienteNovo.telefone" placeholder="Telefone (opcional)" 
                   style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;" />
            <input type="email" [(ngModel)]="clienteNovo.email" placeholder="Email (opcional)" 
                   style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;" />
          </div>
        </div>

        <div class="product-grid" *ngIf="listaProdutos.length > 0">
          <div class="product-card" *ngFor="let p of listaProdutos" (click)="adicionarProduto(p)">
            <h4>{{ p.nome }}</h4>
            <p style="font-size: 0.9em; color: #666;">{{ p.categoria }}</p>
            <p class="product-price">R$ {{ p.preco.toFixed(2) }}</p>
          </div>
        </div>
        <div class="no-products" *ngIf="listaProdutos.length === 0">
          Nenhum produto disponÃ­vel
        </div>
      </div>

      <div class="cart-section">
        <h3>Carrinho</h3>
        <div class="cart-items">
          <div class="cart-item" *ngFor="let item of carrinho; let i = index">
            <div class="cart-item-info">
              <h4>{{ item.nome }}</h4>
              <p>R$ {{ item.preco }} cada</p>
            </div>
            <div class="cart-item-actions">
              <div class="qty-control">
                <button class="qty-btn" (click)="diminuirQtd(item)">-</button>
                <span>{{ item.quantidade }}</span>
                <button class="qty-btn" (click)="aumentarQtd(item)">+</button>
              </div>
              <button class="remove-btn" (click)="removerDoCarrinho(i)">Remover</button>
            </div>
          </div>
          <div class="empty-cart" *ngIf="carrinho.length === 0">
            Carrinho vazio
          </div>
        </div>
        <div class="cart-total">
          <h4>Total</h4>
          <div class="total-value">R$ {{ calcularTotal() }}</div>
        </div>
        <button class="btn-finalize" 
                [disabled]="carrinho.length === 0 || !clienteNovo.nome.trim() || carregando" 
                (click)="finalizarVenda()">
          {{ carregando ? 'PROCESSANDO...' : 'FINALIZAR VENDA' }}
        </button>
      </div>
    </div>

    <div *ngIf="vendaConcluida && fichaGerada" style="text-align: center; background: white; padding: 3rem; border-radius: 12px;">
      <h2 style="color: #28a745; margin-bottom: 2rem;">Venda Realizada com Sucesso!</h2>
      <p style="font-size: 1.1rem; margin-bottom: 2rem;">Ficha gerada para o cliente:</p>

      <div style="border: 3px solid #28a745; padding: 2rem; max-width: 400px; margin: 2rem auto; background: #f8f9fa; border-radius: 12px;">
        <h3 style="color: #28a745; margin-bottom: 1rem;">ðŸŽ« FICHA DIGITAL</h3>
        <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
          <p><strong>Cliente:</strong> {{ fichaGerada.cliente.nome }}</p>
          <p style="margin-top: 0.5rem;"><strong>CÃ³digo:</strong></p>
          <div style="background: #28a745; color: white; padding: 15px; font-weight: bold; font-size: 1.5em; border-radius: 8px; letter-spacing: 2px; margin-top: 0.5rem;">
            {{ fichaGerada.codigo }}
          </div>
          <p style="font-size: 0.9em; color: #666; margin-top: 1rem;">Status: {{ fichaGerada.status }}</p>
        </div>
        <p style="font-size: 0.85em; color: #666;">Guarde este cÃ³digo para validaÃ§Ã£o</p>
      </div>

      <button (click)="novaVenda()" class="btn-finalize" style="max-width: 300px; margin: 2rem auto; background: #28a745;">
        ðŸ”„ FAZER NOVA VENDA
      </button>
    </div>
  </div>
</div>