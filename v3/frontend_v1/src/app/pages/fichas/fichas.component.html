<div class="page-container">
  <header class="top-header">
    <div class="header-brand">
<<<<<<< HEAD
      <h1>Caneco Cheio</h1>
=======
      <h1>Gest√£o de Eventos e Bebidas</h1>
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
    </div>
    <nav class="top-nav">
      <a routerLink="/produtos">Gerenciar Produtos</a>
      <a routerLink="/eventos">Gerenciar Eventos</a>
      <a routerLink="/estoque">Estoque</a>
      <a routerLink="/venda">Nova Venda (PDV)</a>
      <a routerLink="/caixa">Controle de Caixa</a>
      <a routerLink="/fichas" routerLinkActive="active">Fichas</a>
    </nav>
    <button class="logout-btn" routerLink="/dashboard">Voltar</button>
  </header>

  <div class="main-content">
    <div class="page-header">
      <h2>üé´ Gest√£o de Fichas</h2>
    </div>

    <!-- ABAS -->
    <div class="tabs-container">
      <button 
        class="tab-button" 
        [class.active]="abaAtiva === 'vender'"
        (click)="mudarAba('vender')">
<<<<<<< HEAD
        Vender Fichas
=======
        üí∞ Vender Fichas
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
      </button>
      <button 
        class="tab-button" 
        [class.active]="abaAtiva === 'validar'"
        (click)="mudarAba('validar')">
<<<<<<< HEAD
        Validar Ficha
=======
        ‚úÖ Validar Ficha
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
      </button>
      <button 
        class="tab-button" 
        [class.active]="abaAtiva === 'relatorio'"
        (click)="mudarAba('relatorio')">
<<<<<<< HEAD
        Relat√≥rio
=======
        üìã Relat√≥rio
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
      </button>
    </div>

    <!-- CONTE√öDO DAS ABAS -->
    
    <!-- ABA: VENDER FICHAS -->
    <div *ngIf="abaAtiva === 'vender'" class="tab-content">
      <div class="form-card">
        <h3>Emitir Nova Ficha</h3>
        <form (ngSubmit)="gerarFichas()" class="fichas-form">
          <div style="display:flex; gap:10px; margin-bottom:12px; align-items:center;">
            <div style="flex:1;">
              <label style="font-weight:600;">Cliente ID (opcional):</label>
              <input type="number" [(ngModel)]="clienteIdInput" name="clienteIdInput" placeholder="Informe o ID do cliente" />
            </div>
            <div style="display:flex; gap:8px; align-items:center;">
              <button type="button" class="btn-secondary" (click)="definirCliente()">Definir Cliente</button>
              <button type="button" class="btn-secondary" (click)="limparCliente()">Remover</button>
            </div>
          </div>
          <div style="margin-bottom:12px; display:flex; gap:10px; align-items:center;">
            <button type="button" class="btn-secondary" (click)="buscarClientes()">Listar clientes existentes</button>
            <div *ngIf="clientesList.length > 0" style="display:flex; gap:8px; align-items:center;">
              <select [(ngModel)]="clienteSelectTemp" name="clienteSelectTemp">
                <option [ngValue]="null">-- selecione --</option>
                <option *ngFor="let c of clientesList" [ngValue]="c.id">{{ c.id }} - {{ c.nome }}</option>
              </select>
              <button type="button" class="btn-secondary" (click)="selecionarClienteTemp()">Selecionar</button>
            </div>
          </div>
          <div style="margin-bottom:12px; border:1px dashed #ddd; padding:12px; border-radius:6px;">
            <h4 style="margin:0 0 8px 0;">Criar Cliente</h4>
            <div style="display:flex; gap:8px;">
              <input type="text" [(ngModel)]="clienteNomeInput" name="clienteNomeInput" placeholder="Nome*" style="flex:2;" />
              <input type="tel" [(ngModel)]="clienteTelefoneInput" name="clienteTelefoneInput" placeholder="Telefone" style="flex:1;" />
              <input type="email" [(ngModel)]="clienteEmailInput" name="clienteEmailInput" placeholder="Email" style="flex:1;" />
              <button type="button" class="btn-secondary" (click)="createCliente()">Criar Cliente</button>
            </div>
            <div style="font-size:0.85em; color:#666; margin-top:8px;">Crie um cliente antes de gerar fichas para evitar erro 'Cliente n√£o encontrado'.</div>
          </div>
          <div class="form-row">
            <div class="form-field">
              <label>Valor da Ficha (R$):</label>
              <input type="number" [(ngModel)]="valorInput" name="valor" placeholder="0,00" class="input-grande" required />
            </div>
            <div class="form-field">
              <label>Quantidade:</label>
              <input type="number" [(ngModel)]="quantidadeInput" name="quantidade" min="1" value="1" required />
            </div>
          </div>
<<<<<<< HEAD
          <button type="submit" class="btn-primary">GERAR FICHAS</button>
=======
          <button type="submit" class="btn-primary">GERAR FICHAS üñ®Ô∏è</button>
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
        </form>
      </div>

      <div *ngIf="fichasGeradas.length > 0" class="tickets-section">
        <div class="section-header">
          <h3>Fichas Emitidas Agora</h3>
          <div class="action-buttons">
<<<<<<< HEAD
            <button (click)="imprimir()" class="btn-action btn-print">Imprimir</button>
            <button (click)="limparTela()" class="btn-action btn-clear">Limpar Tela</button>
=======
            <button (click)="imprimir()" class="btn-action btn-print">üìÑ Imprimir</button>
            <button (click)="limparTela()" class="btn-action btn-clear">üóëÔ∏è Limpar Tela</button>
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
          </div>
        </div>

        <div class="tickets-grid">
          <div *ngFor="let ficha of fichasGeradas" class="ticket">
            <div class="ticket-header">Ficha de Consumo</div>
<<<<<<< HEAD
            <div class="ticket-valor">Saldo: R$ {{ ficha.saldo | number:'1.2-2' }}</div>
            <div class="ticket-code">{{ ficha.codigo }}</div>
            <div class="ticket-footer">
              Status: {{ ficha.status }}<br>
              Limite: R$ {{ ficha.limite | number:'1.2-2' }}
=======
            <div class="ticket-valor">R$ {{ ficha.valor | number:'1.2-2' }}</div>
            <div class="ticket-code">{{ ficha.codigo }}</div>
            <div class="ticket-footer">
              {{ ficha.data | date:'dd/MM/yyyy HH:mm' }}<br>
              *V√°lido apenas hoje
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="fichasGeradas.length === 0" class="tickets-section">
        <div class="no-tickets">Nenhuma ficha emitida ainda. Preencha o formul√°rio acima para gerar fichas.</div>
      </div>
    </div>

    <!-- ABA: VALIDAR FICHA -->
    <div *ngIf="abaAtiva === 'validar'" class="tab-content">
      <div class="validation-card">
        <h3>Digite o C√≥digo da Ficha</h3>
        <form class="validation-form" (ngSubmit)="consultarFicha()">
          <div class="form-field">
            <label>C√≥digo da Ficha:</label>
            <input type="text" [(ngModel)]="codigoInput" name="codigo" placeholder="Ex: a1b2-c3d4..." required />
          </div>
<<<<<<< HEAD
          <button type="submit" class="btn-validate">CONSULTAR</button>
        </form>

        <div *ngIf="mensagemErro" class="result-card result-error">
          <h4>Erro</h4>
=======
          <button type="submit" class="btn-validate">üîç CONSULTAR</button>
        </form>

        <div *ngIf="mensagemErro" class="result-card result-error">
          <h4>‚ùå Erro</h4>
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
          <p>{{ mensagemErro }}</p>
        </div>

        <div *ngIf="carregando" style="text-align: center; padding: 2rem;">
          <p>Carregando...</p>
        </div>

        <div *ngIf="fichaEncontrada" class="result-card" 
<<<<<<< HEAD
             [class.result-success]="fichaEncontrada.status === 'GERADA' && fichaEncontrada.saldo > 0" 
             [class.result-error]="fichaEncontrada.status === 'UTILIZADA' || fichaEncontrada.saldo <= 0">
          <h4>
            <span *ngIf="fichaEncontrada.status === 'GERADA' && fichaEncontrada.saldo > 0">‚úÖ FICHA V√ÅLIDA COM SALDO</span>
            <span *ngIf="fichaEncontrada.saldo <= 0">‚ùå FICHA SEM SALDO</span>
            <span *ngIf="fichaEncontrada.status === 'UTILIZADA' && fichaEncontrada.saldo > 0">‚ö†Ô∏è FICHA PARCIALMENTE USADA</span>
          </h4>
=======
             [class.result-success]="fichaEncontrada.status === 'GERADA'" 
             [class.result-error]="fichaEncontrada.status !== 'GERADA'">
          <h4>{{ fichaEncontrada.status === 'GERADA' ? '‚úÖ FICHA V√ÅLIDA' : '‚ùå FICHA J√Å UTILIZADA' }}</h4>
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
          
          <div style="text-align: left; margin: 1rem 0;">
            <p><strong>Cliente:</strong> {{ fichaEncontrada.cliente?.nome || 'N/A' }}</p>
            <p *ngIf="fichaEncontrada.cliente?.telefone"><strong>Telefone:</strong> {{ fichaEncontrada.cliente.telefone }}</p>
            <p *ngIf="fichaEncontrada.cliente?.email"><strong>Email:</strong> {{ fichaEncontrada.cliente.email }}</p>
            <p><strong>C√≥digo:</strong> <code style="background: #f0f0f0; padding: 5px 10px; border-radius: 4px;">{{ fichaEncontrada.codigo }}</code></p>
<<<<<<< HEAD
            <p style="font-size: 1.2em; font-weight: bold;" [style.color]="fichaEncontrada.saldo > 0 ? '#28a745' : '#dc3545'">
              <strong>üí∞ Saldo Dispon√≠vel:</strong> R$ {{ fichaEncontrada.saldo?.toFixed(2) || '0.00' }}
            </p>
            <p><strong>Limite Original:</strong> R$ {{ fichaEncontrada.limite?.toFixed(2) || '0.00' }}</p>
=======
            <p><strong>Saldo:</strong> R$ {{ fichaEncontrada.saldo?.toFixed(2) || '0.00' }}</p>
            <p><strong>Limite:</strong> R$ {{ fichaEncontrada.limite?.toFixed(2) || '0.00' }}</p>
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
            <p><strong>Status:</strong> 
              <span [style.color]="fichaEncontrada.status === 'GERADA' ? '#28a745' : '#dc3545'" style="font-weight: bold;">
                {{ fichaEncontrada.status }}
              </span>
            </p>
          </div>
          
          <div style="display: flex; gap: 10px; margin-top: 1.5rem;">
<<<<<<< HEAD
            <button *ngIf="fichaEncontrada.saldo > 0" 
=======
            <button *ngIf="fichaEncontrada.status === 'GERADA'" 
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
                    (click)="entregarProduto()"
                    [disabled]="carregando"
                    class="btn-validate" 
                    style="flex: 1; background: #28a745;">
<<<<<<< HEAD
              {{ carregando ? 'Processando...' : 'üç∫ CONSUMIR/ENTREGAR' }}
=======
              {{ carregando ? 'Processando...' : 'üç∫ ENTREGAR PRODUTO' }}
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
            </button>
            
            <button (click)="limparBusca()" 
                    class="btn-validate" 
                    style="flex: 1; background: #6c757d;">
              üîÑ NOVA CONSULTA
            </button>
          </div>
          
<<<<<<< HEAD
          <p *ngIf="fichaEncontrada.saldo <= 0" 
             style="margin-top: 1rem; font-style: italic; color: #dc3545;">
            ‚ö†Ô∏è Esta ficha n√£o possui mais saldo dispon√≠vel. Todo o cr√©dito j√° foi consumido.
          </p>
          <p *ngIf="fichaEncontrada.saldo > 0 && fichaEncontrada.saldo < fichaEncontrada.limite" 
             style="margin-top: 1rem; font-style: italic; color: #ff9800;">
            ‚ÑπÔ∏è Esta ficha foi parcialmente utilizada. Saldo restante: R$ {{ fichaEncontrada.saldo?.toFixed(2) || '0.00' }}
=======
          <p *ngIf="fichaEncontrada.status !== 'GERADA'" 
             style="margin-top: 1rem; font-style: italic; color: #dc3545;">
            ‚ö†Ô∏è Esta ficha j√° foi utilizada e n√£o pode ser reutilizada.
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
          </p>
        </div>
      </div>
    </div>

    <!-- ABA: RELAT√ìRIO -->
    <div *ngIf="abaAtiva === 'relatorio'" class="tab-content">
      <div class="filter-card">
        <h3>Filtros</h3>
        <div class="filter-grid">
          <div class="form-field">
            <label>Pesquisar:</label>
<<<<<<< HEAD
            <input type="text" [(ngModel)]="filtro" placeholder="C√≥digo ou status..." />
=======
            <input type="text" [(ngModel)]="filtro" placeholder="üîç C√≥digo ou status..." />
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
          </div>
          <div class="form-field" style="display: flex; align-items: flex-end;">
            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; flex: 1; text-align: center;">
              <strong style="color: #007bff;">Total Emitido:</strong>
              <div style="font-size: 1.5rem; font-weight: bold; color: #007bff; margin-top: 0.5rem;">
                R$ {{ calcularTotalVendido() | number:'1.2-2' }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="table-section">
        <div class="table-header">
          <h3>Fichas Registradas</h3>
        </div>
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>Data/Hora</th>
                <th>C√≥digo</th>
                <th>Cliente</th>
                <th>Valor</th>
                <th>Status</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let ficha of fichasFiltradas; let i = index">
<<<<<<< HEAD
                <td>{{ ficha.dataCriacao | date:'dd/MM/yyyy HH:mm' }}</td>
=======
                <td>{{ ficha.dataHora || ficha.data | date:'dd/MM/yyyy HH:mm' }}</td>
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
                <td style="font-family: monospace; font-weight: bold; font-size: 1.1em; color: #007bff;">
                  {{ ficha.codigo }}
                </td>
                <td>{{ ficha.cliente?.nome || 'N/A' }}</td>
<<<<<<< HEAD
                <td>R$ {{ ficha.saldo | number:'1.2-2' }}</td>
=======
                <td>R$ {{ ficha.valor | number:'1.2-2' }}</td>
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
                <td>
                  <span class="status-badge" 
                        [style.background]="ficha.status === 'GERADA' || ficha.status === 'ATIVA' ? '#28a745' : '#dc3545'"
                        [style.color]="'white'"
                        [style.padding]="'5px 10px'"
                        [style.border-radius]="'4px'"
                        [style.font-size]="'0.85em'">
                    {{ ficha.status }}
                  </span>
                  <div *ngIf="ficha.dataBaixa" style="font-size: 0.75em; color: #666; margin-top: 0.25rem;">
                    {{ ficha.dataBaixa | date:'HH:mm' }}
                  </div>
                </td>
                <td>
                  <div class="action-buttons">
                    <button *ngIf="ficha.status === 'ATIVA' || ficha.status === 'GERADA'" 
                            (click)="darBaixa(ficha)" 
                            class="btn-action" 
                            style="background: #ffc107; color: #000; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-right: 5px;"
                            title="Marcar como usada">
                      ‚¨áÔ∏è Baixar
                    </button>
                    <button *ngIf="ficha.status === 'BAIXADA' || ficha.status === 'VALIDADA'" 
                            (click)="reativar(ficha)" 
                            class="btn-action" 
                            style="background: #17a2b8; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-right: 5px;"
                            title="Reativar ficha">
                      üîÑ Reativar
                    </button>
                    <button (click)="excluir(i)" 
                            class="btn-action" 
                            style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;"
                            title="Remover registro">
<<<<<<< HEAD
                      Excluir
=======
                      üóëÔ∏è Excluir
>>>>>>> 7a918497ebee151fabee2fa8e53dade07b3544a5
                    </button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="fichasFiltradas.length === 0">
                <td colspan="6" class="no-data">Nenhuma ficha encontrada.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
